<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Campeonato</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase -->
    <script type="module">
        // Import SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        // Config Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBo8G3ZcWk4EepN0cHdVBtXc7tGOfcw-yg",
            authDomain: "inscricaosinuca.firebaseapp.com",
            projectId: "inscricaosinuca",
            storageBucket: "inscricaosinuca.firebasestorage.app",
            messagingSenderId: "338241576305",
            appId: "1:338241576305:web:288b6124384c6be4f76ad0",
            measurementId: "G-PEDG30FS2R"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // üîπ Fun√ß√µes de banco de dados
        async function salvarInscrito(inscrito) {
            await addDoc(collection(db, "inscritos"), inscrito);
        }

        async function listarInscritos() {
            const querySnapshot = await getDocs(collection(db, "inscritos"));
            return querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        }

        async function removerInscritoDB(id) {
            await deleteDoc(doc(db, "inscritos", id));
        }

        async function salvarConfig(config) {
            await setDoc(doc(db, "config", "geral"), config);
        }

        async function carregarConfig() {
            const querySnapshot = await getDocs(collection(db, "config"));
            let cfg = {};
            querySnapshot.forEach(doc => cfg = doc.data());
            return cfg;
        }

        window.dbFunctions = { salvarInscrito, listarInscritos, removerInscritoDB, salvarConfig, carregarConfig };
    </script>
</head>
<body class="bg-gray-100 min-h-screen p-4">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-6">Sistema de Campeonato üèÜ</h1>

        <!-- Bot√µes principais -->
        <div class="flex flex-wrap justify-center gap-2 mb-6">
            <button id="inscricaoBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                üìù Inscri√ß√µes
            </button>
            <button id="publicoBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                üë• Lista P√∫blica
            </button>
            <button id="adminBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">
                ‚öôÔ∏è Admin
            </button>
            <button id="acompanharBtn" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg">
                üìä Acompanhar
            </button>
        </div>

        <!-- Se√ß√µes (igual ao seu arquivo original) -->
        <section id="inscricaoSection" class="bg-white p-6 rounded-lg shadow mb-6">
            <h2 class="text-xl font-bold mb-4">Nova Inscri√ß√£o</h2>
            <form id="inscricaoForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="matricula" placeholder="Matr√≠cula" class="p-2 border rounded-lg" required>
                    <input type="text" id="nome" placeholder="Nome completo" class="p-2 border rounded-lg" required>
                    <input type="text" id="setor" placeholder="Setor" class="p-2 border rounded-lg" required>
                    <input type="tel" id="telefone" placeholder="Telefone" class="p-2 border rounded-lg" required>
                </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg">
                    Enviar Inscri√ß√£o
                </button>
            </form>
        </section>

        <section id="publicoSection" class="bg-white p-6 rounded-lg shadow mb-6 hidden">
            <h2 class="text-xl font-bold mb-4">Participantes Inscritos</h2>
            <div id="participantesList" class="space-y-3"></div>
        </section>

        <section id="adminSection" class="bg-white p-6 rounded-lg shadow mb-6 hidden">
            <h2 class="text-xl font-bold mb-4">√Årea Administrativa</h2>
            <table class="w-full border text-sm">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="border p-2">Nome</th>
                        <th class="border p-2">Setor</th>
                        <th class="border p-2">A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="tabelaInscritos"></tbody>
            </table>
        </section>
    </div>

    <script type="module">
        import { dbFunctions } from "./index.js"; // üîπ ou pode usar window.dbFunctions

        const { salvarInscrito, listarInscritos, removerInscritoDB } = window.dbFunctions;

        // Navega√ß√£o
        function showSection(section) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(section + 'Section').classList.remove('hidden');
        }

        document.getElementById('inscricaoBtn').onclick = () => showSection('inscricao');
        document.getElementById('publicoBtn').onclick = async () => {
            showSection('publico');
            const lista = document.getElementById('participantesList');
            lista.innerHTML = '';
            const inscritos = await listarInscritos();
            inscritos.forEach(p => {
                lista.innerHTML += `<div class="p-3 border rounded-lg"><h3 class="font-semibold">${p.nome}</h3><p>${p.setor}</p></div>`;
            });
        };
        document.getElementById('adminBtn').onclick = async () => {
            const senha = prompt("Senha do administrador:");
            if (senha === "dpsp123") {
                showSection('admin');
                const tabela = document.getElementById('tabelaInscritos');
                tabela.innerHTML = '';
                const inscritos = await listarInscritos();
                inscritos.forEach(p => {
                    tabela.innerHTML += `
                        <tr>
                            <td class="border p-2">${p.nome}</td>
                            <td class="border p-2">${p.setor}</td>
                            <td class="border p-2">
                                <button onclick="window.remover('${p.id}')" class="text-red-600">üóëÔ∏è</button>
                            </td>
                        </tr>`;
                });
            } else {
                alert("Senha incorreta!");
            }
        };

        // Inscri√ß√£o
        document.getElementById('inscricaoForm').onsubmit = async (e) => {
            e.preventDefault();
            const inscrito = {
                matricula: document.getElementById('matricula').value,
                nome: document.getElementById('nome').value,
                setor: document.getElementById('setor').value,
                telefone: document.getElementById('telefone').value,
                criado: new Date().toISOString()
            };
            await salvarInscrito(inscrito);
            alert("Inscri√ß√£o realizada!");
            e.target.reset();
        };

        // Remover inscrito
        window.remover = async (id) => {
            if (confirm("Remover participante?")) {
                await removerInscritoDB(id);
                alert("Removido!");
                document.getElementById('adminBtn').click();
            }
        };

        // Inicializa√ß√£o
        window.onload = () => {
            showSection('inscricao');
        };
    </script>
</body>
</html>
