<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Campeonato de Sinuca</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">

  <!-- Cadastro de Participantes -->
  <div class="max-w-xl mx-auto bg-white p-6 mt-6 rounded shadow">
    <h2 class="text-xl font-bold mb-4">Inscrição</h2>
    <input id="nome" type="text" placeholder="Nome" class="border p-2 w-full mb-2">
    <input id="telefone" type="text" placeholder="Telefone" class="border p-2 w-full mb-2">
    <select id="modalidade" class="border p-2 w-full mb-2"></select>
    <button onclick="adicionarParticipante()" class="bg-green-600 text-white px-4 py-2 rounded">Inscrever</button>
  </div>

  <!-- Lista de Participantes -->
  <div class="max-w-xl mx-auto bg-white p-6 mt-6 rounded shadow">
    <h2 class="text-xl font-bold mb-4">Participantes</h2>
    <ul id="listaParticipantes" class="list-disc pl-6"></ul>
  </div>

  <!-- Administração -->
  <div class="max-w-3xl mx-auto bg-white p-6 mt-6 rounded shadow">
    <h2 class="text-xl font-bold mb-4">Administração</h2>

    <!-- Modalidades -->
    <div class="mb-6">
      <h3 class="font-semibold mb-2">Modalidades</h3>
      <input id="novaModalidade" type="text" placeholder="Nome da modalidade" class="border p-2 w-full mb-2">
      <button onclick="adicionarModalidade()" class="bg-blue-600 text-white px-4 py-2 rounded mb-2">Adicionar Modalidade</button>
      <ul id="listaModalidades" class="list-disc pl-6"></ul>
    </div>

    <!-- Participantes -->
    <div class="mb-6">
      <h3 class="font-semibold mb-2">Participantes (ADM)</h3>
      <table class="w-full border">
        <thead>
          <tr class="bg-gray-200">
            <th class="p-2 border">Nome</th>
            <th class="p-2 border">Telefone</th>
            <th class="p-2 border">Modalidade</th>
            <th class="p-2 border">Ações</th>
          </tr>
        </thead>
        <tbody id="tabelaAdm"></tbody>
      </table>
    </div>

    <!-- Fases -->
    <div>
      <h3 class="font-semibold mb-2">Gerenciar Fases</h3>
      <button onclick="sortearEmbate()" class="bg-purple-600 text-white px-4 py-2 rounded mr-2">Sortear Embate</button>
      <button onclick="criarProximaFase()" class="bg-orange-600 text-white px-4 py-2 rounded">Criar Próxima Fase</button>
      <div id="fasesContainer" class="mt-4"></div>
    </div>
  </div>

  <script>
    let participantes = JSON.parse(localStorage.getItem("participantes")) || [];
    let modalidades = JSON.parse(localStorage.getItem("modalidades")) || [];
    let fases = JSON.parse(localStorage.getItem("fases")) || [];

    // Salvar no localStorage
    function salvar() {
      localStorage.setItem("participantes", JSON.stringify(participantes));
      localStorage.setItem("modalidades", JSON.stringify(modalidades));
      localStorage.setItem("fases", JSON.stringify(fases));
    }

    // Renderizar
    function renderizar() {
      // Participantes públicos
      const lista = document.getElementById("listaParticipantes");
      lista.innerHTML = "";
      participantes.forEach(p => {
        const li = document.createElement("li");
        li.textContent = `${p.nome} (${p.modalidade})`;
        lista.appendChild(li);
      });

      // Participantes ADM
      const tabela = document.getElementById("tabelaAdm");
      tabela.innerHTML = "";
      participantes.forEach((p, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="border p-2">${p.nome}</td>
          <td class="border p-2">${p.telefone}</td>
          <td class="border p-2">${p.modalidade}</td>
          <td class="border p-2">
            <button onclick="excluirParticipante(${i})" class="bg-red-600 text-white px-2 py-1 rounded">Excluir</button>
          </td>
        `;
        tabela.appendChild(tr);
      });

      // Modalidades
      const select = document.getElementById("modalidade");
      select.innerHTML = "";
      modalidades.forEach(m => {
        const opt = document.createElement("option");
        opt.value = m;
        opt.textContent = m;
        select.appendChild(opt);
      });

      const listaM = document.getElementById("listaModalidades");
      listaM.innerHTML = "";
      modalidades.forEach((m, i) => {
        const li = document.createElement("li");
        li.innerHTML = `
          ${m} 
          <button onclick="excluirModalidade(${i})" class="bg-red-600 text-white px-2 py-1 rounded ml-2">Excluir</button>
        `;
        listaM.appendChild(li);
      });

      // Fases
      const fasesDiv = document.getElementById("fasesContainer");
      fasesDiv.innerHTML = "";
      fases.forEach((fase, fi) => {
        const div = document.createElement("div");
        div.className = "p-4 border rounded mb-4";
        div.innerHTML = `<h4 class="font-bold mb-2">Fase ${fi+1}</h4>`;
        fase.forEach((jogo, ji) => {
          div.innerHTML += `
            <p>
              ${jogo.jogador1} (${jogo.pontos1}) vs 
              ${jogo.jogador2} (${jogo.pontos2})
              <button onclick="registrarVitoria(${fi}, ${ji}, 1)" class="bg-green-600 text-white px-2 py-1 rounded ml-2">Vitória P1</button>
              <button onclick="registrarVitoria(${fi}, ${ji}, 2)" class="bg-green-600 text-white px-2 py-1 rounded">Vitória P2</button>
            </p>
          `;
        });
        fasesDiv.appendChild(div);
      });
    }

    // Adicionar participante
    function adicionarParticipante() {
      const nome = document.getElementById("nome").value.trim();
      const telefone = document.getElementById("telefone").value.trim();
      const modalidade = document.getElementById("modalidade").value;
      if (!nome || !telefone || !modalidade) return alert("Preencha todos os campos");
      participantes.push({ nome, telefone, modalidade });
      salvar();
      renderizar();
    }

    // Excluir participante
    function excluirParticipante(i) {
      const senha = prompt("Digite a senha de ADM:");
      if (senha !== "dpsp123") return alert("Senha incorreta!");
      participantes.splice(i, 1);
      salvar();
      renderizar();
    }

    // Adicionar modalidade
    function adicionarModalidade() {
      const m = document.getElementById("novaModalidade").value.trim();
      if (!m) return alert("Informe o nome da modalidade");
      modalidades.push(m);
      salvar();
      renderizar();
    }

    // Excluir modalidade
    function excluirModalidade(i) {
      const senha = prompt("Digite a senha de ADM:");
      if (senha !== "dpsp123") return alert("Senha incorreta!");
      const removida = modalidades[i];
      modalidades.splice(i, 1);
      participantes = participantes.filter(p => p.modalidade !== removida);
      salvar();
      renderizar();
    }

    // Sortear embate
    function sortearEmbate() {
      if (participantes.length < 2) return alert("Participantes insuficientes");
      let sorteados = [...participantes].sort(() => Math.random() - 0.5);
      let jogos = [];
      for (let i = 0; i < sorteados.length; i+=2) {
        if (sorteados[i+1]) {
          jogos.push({ jogador1: sorteados[i].nome, pontos1: 0, jogador2: sorteados[i+1].nome, pontos2: 0 });
        }
      }
      fases = [jogos]; // Apaga fases antigas
      salvar();
      renderizar();
    }

    // Registrar vitória
    function registrarVitoria(fi, ji, vencedor) {
      if (vencedor === 1) fases[fi][ji].pontos1++;
      else fases[fi][ji].pontos2++;
      salvar();
      renderizar();
    }

    // Próxima fase
    function criarProximaFase() {
      let ultima = fases[fases.length-1];
      if (!ultima) return alert("Nenhuma fase encontrada");
      let vencedores = ultima.map(jogo => 
        jogo.pontos1 > jogo.pontos2 ? jogo.jogador1 : jogo.jogador2
      );
      if (vencedores.length < 2) return alert("Campeão definido!");
      let jogos = [];
      for (let i = 0; i < vencedores.length; i+=2) {
        if (vencedores[i+1]) {
          jogos.push({ jogador1: vencedores[i], pontos1: 0, jogador2: vencedores[i+1], pontos2: 0 });
        }
      }
      fases = [jogos]; // Apaga fases anteriores
      salvar();
      renderizar();
    }

    renderizar();
  </script>
</body>
</html>
