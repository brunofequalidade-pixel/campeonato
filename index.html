<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Campeonato</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-4">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-6">Sistema de Campeonato üèÜ</h1>

        <!-- Navega√ß√£o -->
        <div class="flex flex-wrap justify-center gap-2 mb-6">
            <button id="inscricaoBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                üìù Inscri√ß√µes
            </button>
            <button id="publicoBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                üë• Lista P√∫blica
            </button>
            <button id="adminBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">
                ‚öôÔ∏è Admin
            </button>
            <button id="acompanharBtn" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg">
                üìä Acompanhar
            </button>
        </div>

        <!-- Se√ß√£o de Inscri√ß√µes -->
        <section id="inscricaoSection" class="bg-white p-6 rounded-lg shadow mb-6">
            <h2 class="text-xl font-bold mb-4">Nova Inscri√ß√£o</h2>
            <form id="inscricaoForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="matricula" placeholder="Matr√≠cula" class="p-2 border rounded-lg" required>
                    <input type="text" id="nome" placeholder="Nome completo" class="p-2 border rounded-lg" required>
                    <input type="text" id="setor" placeholder="Setor" class="p-2 border rounded-lg" required>
                    <input type="tel" id="telefone" placeholder="Telefone" class="p-2 border rounded-lg" required>
                </div>
                <div>
                    <p class="font-semibold mb-2">Escolha suas modalidades:</p>
                    <div id="modalidadesList" class="grid grid-cols-2 gap-2"></div>
                    <p id="modalidadeInfo" class="text-sm text-gray-500 mt-2"></p>
                </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg">
                    Enviar Inscri√ß√£o
                </button>
            </form>
        </section>

        <!-- Lista P√∫blica -->
        <section id="publicoSection" class="bg-white p-6 rounded-lg shadow mb-6 hidden">
            <h2 class="text-xl font-bold mb-4">Participantes Inscritos</h2>
            <div id="participantesList" class="space-y-3"></div>
        </section>

        <!-- Acompanhar -->
        <section id="acompanharSection" class="bg-white p-6 rounded-lg shadow mb-6 hidden">
            <h2 class="text-xl font-bold mb-4">Acompanhar Jogos</h2>
            <div id="jogosAcompanhar" class="space-y-4"></div>
        </section>

        <!-- Admin -->
        <section id="adminSection" class="bg-white p-6 rounded-lg shadow mb-6 hidden">
            <h2 class="text-xl font-bold mb-4">√Årea Administrativa</h2>
            
            <div class="flex flex-wrap gap-2 mb-4">
                <button id="configTab" class="bg-gray-600 text-white px-3 py-1 rounded">Config</button>
                <button id="fasesTab" class="bg-gray-400 text-white px-3 py-1 rounded">Fases</button>
                <button id="placaresTab" class="bg-gray-400 text-white px-3 py-1 rounded">Placares</button>
                <button id="resetTab" class="bg-gray-400 text-white px-3 py-1 rounded">Reset</button>
            </div>

            <!-- Config -->
            <div id="configDiv" class="space-y-4">
                <div>
                    <h3 class="font-semibold mb-2">Modalidades</h3>
                    <div id="adminModalidadesList" class="space-y-2 mb-3"></div>
                    <div class="flex gap-2">
                        <input type="text" id="novaModalidade" placeholder="Nova modalidade" class="flex-1 p-2 border rounded">
                        <button id="addModalidade" class="bg-green-600 text-white px-3 py-2 rounded">Add</button>
                    </div>
                </div>
                <div>
                    <h3 class="font-semibold mb-2">Limite por Participante</h3>
                    <div class="flex gap-2">
                        <input type="number" id="limiteInput" min="1" value="2" class="p-2 border rounded w-20">
                        <button id="salvarLimite" class="bg-blue-600 text-white px-3 py-2 rounded">Salvar</button>
                    </div>
                </div>
                <div>
                    <button id="exportBtn" class="bg-indigo-600 text-white px-4 py-2 rounded mr-2">Exportar CSV</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border text-sm">
                        <thead class="bg-gray-200">
                            <tr>
                                <th class="border p-2">Nome</th>
                                <th class="border p-2">Setor</th>
                                <th class="border p-2">Modalidades</th>
                                <th class="border p-2">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaInscritos"></tbody>
                    </table>
                </div>
            </div>

            <!-- Fases -->
            <div id="fasesDiv" class="hidden space-y-4">
                <div class="flex gap-2">
                    <select id="modalidadeSelect" class="flex-1 p-2 border rounded">
                        <option value="">Selecione modalidade</option>
                    </select>
                    <button id="criarFaseBtn" class="bg-green-600 text-white px-4 py-2 rounded">Criar Fase</button>
                </div>
                <div id="faseAtual" class="mt-4"></div>
            </div>

            <!-- Placares -->
            <div id="placaresDiv" class="hidden space-y-4">
                <select id="modalidadePlacar" class="w-full p-2 border rounded mb-4">
                    <option value="">Selecione modalidade para ver jogos</option>
                </select>
                <div id="jogosPendentes"></div>
            </div>

            <!-- Reset -->
            <div id="resetDiv" class="hidden">
                <div class="bg-red-50 p-4 rounded border border-red-200">
                    <h3 class="font-semibold text-red-800 mb-2">‚ö†Ô∏è Reset Campeonato</h3>
                    <p class="text-red-700 mb-4">Apaga todas as fases e placares. Mant√©m participantes.</p>
                    <button id="resetBtn" class="bg-red-600 text-white px-4 py-2 rounded">Reset Completo</button>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Vari√°veis globais
        let inscritos = [];
        let modalidades = [];
        let limite = 2;

        // Simulando Firebase com localStorage
        const storage = {
            inscritos: JSON.parse(localStorage.getItem('inscritos') || '[]'),
            modalidades: JSON.parse(localStorage.getItem('modalidades') || '["Sinuca", "Domin√≥", "Dama"]'),
            fases: JSON.parse(localStorage.getItem('fases') || '{}'),
            jogos: JSON.parse(localStorage.getItem('jogos') || '{}'),
            config: JSON.parse(localStorage.getItem('config') || '{"limite": 2}')
        };

        function saveStorage() {
            localStorage.setItem('inscritos', JSON.stringify(storage.inscritos));
            localStorage.setItem('modalidades', JSON.stringify(storage.modalidades));
            localStorage.setItem('fases', JSON.stringify(storage.fases));
            localStorage.setItem('jogos', JSON.stringify(storage.jogos));
            localStorage.setItem('config', JSON.stringify(storage.config));
        }

        // Navega√ß√£o
        function showSection(section) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(section + 'Section').classList.remove('hidden');
            
            // Reset button colors
            document.querySelectorAll('[id$="Btn"]').forEach(btn => {
                btn.className = btn.className.replace('bg-gray-800', btn.id.includes('inscricao') ? 'bg-blue-600' : 
                    btn.id.includes('publico') ? 'bg-green-600' : 
                    btn.id.includes('admin') ? 'bg-purple-600' : 'bg-orange-600');
            });
            
            document.getElementById(section + 'Btn').className = document.getElementById(section + 'Btn').className.replace(/bg-\w+-600/, 'bg-gray-800');
        }

        // Event listeners navega√ß√£o
        document.getElementById('inscricaoBtn').onclick = () => showSection('inscricao');
        document.getElementById('publicoBtn').onclick = () => {
            showSection('publico');
            carregarListaPublica();
        };
        document.getElementById('acompanharBtn').onclick = () => {
            showSection('acompanhar');
            carregarAcompanhamento();
        };
        document.getElementById('adminBtn').onclick = () => {
            const senha = prompt("Senha do administrador:");
            if (senha === "dpsp123") {
                showSection('admin');
                carregarAdmin();
            } else if (senha) {
                alert("Senha incorreta!");
            }
        };

        // Tabs Admin
        function showAdminTab(tab) {
            ['configTab', 'fasesTab', 'placaresTab', 'resetTab'].forEach(t => {
                document.getElementById(t).className = "bg-gray-400 text-white px-3 py-1 rounded";
            });
            ['configDiv', 'fasesDiv', 'placaresDiv', 'resetDiv'].forEach(d => {
                document.getElementById(d).classList.add('hidden');
            });
            
            document.getElementById(tab + 'Tab').className = "bg-gray-600 text-white px-3 py-1 rounded";
            document.getElementById(tab + 'Div').classList.remove('hidden');
        }

        document.getElementById('configTab').onclick = () => showAdminTab('config');
        document.getElementById('fasesTab').onclick = () => {
            showAdminTab('fases');
            carregarModalidadesSelect();
        };
        document.getElementById('placaresTab').onclick = () => {
            showAdminTab('placares');
            carregarPlacarSelect();
        };
        document.getElementById('resetTab').onclick = () => showAdminTab('reset');

        // Modalidades
        function carregarModalidades() {
            modalidades = storage.modalidades;
            limite = storage.config.limite || 2;
            
            // Lista para inscri√ß√£o
            const lista = document.getElementById('modalidadesList');
            lista.innerHTML = '';
            modalidades.forEach(m => {
                const label = document.createElement('label');
                label.className = 'flex items-center gap-2 p-2 border rounded cursor-pointer';
                label.innerHTML = `<input type="checkbox" value="${m}"> ${m}`;
                lista.appendChild(label);
            });
            
            // Lista admin
            const adminLista = document.getElementById('adminModalidadesList');
            adminLista.innerHTML = '';
            modalidades.forEach(m => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center p-2 border rounded';
                div.innerHTML = `<span>${m}</span><button onclick="removerModalidade('${m}')" class="text-red-600 px-2">üóëÔ∏è</button>`;
                adminLista.appendChild(div);
            });
            
            document.getElementById('modalidadeInfo').textContent = `Escolha at√© ${limite} modalidade(s)`;
            document.getElementById('limiteInput').value = limite;
        }

        function removerModalidade(modalidade) {
            if (confirm(`Remover ${modalidade}?`)) {
                storage.modalidades = storage.modalidades.filter(m => m !== modalidade);
                saveStorage();
                carregarModalidades();
            }
        }

        // Adicionar modalidade
        document.getElementById('addModalidade').onclick = () => {
            const nome = document.getElementById('novaModalidade').value.trim();
            if (nome && !storage.modalidades.includes(nome)) {
                storage.modalidades.push(nome);
                saveStorage();
                document.getElementById('novaModalidade').value = '';
                carregarModalidades();
                alert('Modalidade adicionada!');
            } else {
                alert('Nome inv√°lido ou j√° existe!');
            }
        };

        // Salvar limite
        document.getElementById('salvarLimite').onclick = () => {
            const novoLimite = parseInt(document.getElementById('limiteInput').value);
            if (novoLimite > 0) {
                storage.config.limite = novoLimite;
                saveStorage();
                carregarModalidades();
                alert('Limite salvo!');
            }
        };

        // Inscri√ß√£o
        document.getElementById('inscricaoForm').onsubmit = (e) => {
            e.preventDefault();
            
            const matricula = document.getElementById('matricula').value.trim();
            const nome = document.getElementById('nome').value.trim();
            const setor = document.getElementById('setor').value.trim();
            const telefone = document.getElementById('telefone').value.trim();
            
            const escolhidas = Array.from(document.querySelectorAll('#modalidadesList input:checked')).map(c => c.value);
            
            if (!matricula || !nome || !setor || !telefone) {
                alert('Preencha todos os campos!');
                return;
            }
            
            if (escolhidas.length === 0 || escolhidas.length > limite) {
                alert(`Escolha entre 1 e ${limite} modalidades!`);
                return;
            }
            
            if (storage.inscritos.find(i => i.matricula === matricula)) {
                alert('Matr√≠cula j√° inscrita!');
                return;
            }
            
            storage.inscritos.push({
                id: Date.now().toString(),
                matricula,
                nome,
                setor,
                telefone,
                modalidades: escolhidas,
                criado: new Date().toISOString()
            });
            
            saveStorage();
            alert('Inscri√ß√£o realizada!');
            document.getElementById('inscricaoForm').reset();
            carregarModalidades();
        };

        // Lista p√∫blica
        function carregarListaPublica() {
            const lista = document.getElementById('participantesList');
            lista.innerHTML = '';
            
            if (storage.inscritos.length === 0) {
                lista.innerHTML = '<p class="text-gray-500">Nenhum participante ainda.</p>';
                return;
            }
            
            storage.inscritos.forEach(p => {
                const div = document.createElement('div');
                div.className = 'p-3 border rounded-lg';
                div.innerHTML = `
                    <h3 class="font-semibold">${p.nome}</h3>
                    <p class="text-gray-600">${p.setor}</p>
                    <p class="text-sm text-blue-600">Modalidades: ${p.modalidades.join(', ')}</p>
                `;
                lista.appendChild(div);
            });
        }

        // Admin
        function carregarAdmin() {
            const tabela = document.getElementById('tabelaInscritos');
            tabela.innerHTML = '';
            
            storage.inscritos.forEach(p => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="border p-2">${p.nome}</td>
                    <td class="border p-2">${p.setor}</td>
                    <td class="border p-2">${p.modalidades.join(', ')}</td>
                    <td class="border p-2">
                        <button onclick="removerInscrito('${p.id}')" class="text-red-600 px-2">üóëÔ∏è</button>
                    </td>
                `;
                tabela.appendChild(tr);
            });
        }

        function removerInscrito(id) {
            if (confirm('Remover participante?')) {
                const senha = prompt('Confirme a senha:');
                if (senha === 'dpsp123') {
                    storage.inscritos = storage.inscritos.filter(i => i.id !== id);
                    saveStorage();
                    carregarAdmin();
                }
            }
        }

        // Export CSV
        document.getElementById('exportBtn').onclick = () => {
            if (storage.inscritos.length === 0) {
                alert('Nenhum inscrito!');
                return;
            }
            
            let csv = 'Nome,Setor,Telefone,Modalidades\n';
            storage.inscritos.forEach(p => {
                csv += `"${p.nome}","${p.setor}","${p.telefone}","${p.modalidades.join(' | ')}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'inscritos.csv';
            a.click();
        };

        // Selects modalidades
        function carregarModalidadesSelect() {
            const select = document.getElementById('modalidadeSelect');
            select.innerHTML = '<option value="">Selecione modalidade</option>';
            storage.modalidades.forEach(m => {
                select.innerHTML += `<option value="${m}">${m}</option>`;
            });
        }

        function carregarPlacarSelect() {
            const select = document.getElementById('modalidadePlacar');
            select.innerHTML = '<option value="">Selecione modalidade</option>';
            storage.modalidades.forEach(m => {
                select.innerHTML += `<option value="${m}">${m}</option>`;
            });
        }

        // Criar fase
        document.getElementById('criarFaseBtn').onclick = () => {
            const modalidade = document.getElementById('modalidadeSelect').value;
            if (!modalidade) {
                alert('Selecione uma modalidade!');
                return;
            }
            
            criarFase(modalidade);
        };

        function criarFase(modalidade) {
            const participantes = storage.inscritos.filter(p => p.modalidades.includes(modalidade));
            
            if (participantes.length < 2) {
                alert('M√≠nimo 2 participantes!');
                return;
            }
            
            const faseKey = `${modalidade}_fase`;
            let numeroFase = 1;
            let jogadores = [...participantes];
            
            // Verificar se j√° existe fase
            if (storage.fases[faseKey]) {
                const vencedores = getVencedoresFase(modalidade, storage.fases[faseKey].numero);
                if (vencedores.length === 1) {
                    alert(`${vencedores[0].nome} √© o campe√£o!`);
                    return;
                }
                
                numeroFase = storage.fases[faseKey].numero + 1;
                jogadores = vencedores;
                
                // Se √≠mpar, sortear um perdedor
                if (jogadores.length % 2 === 1) {
                    const perdedores = getPerdedoresFase(modalidade, storage.fases[faseKey].numero);
                    if (perdedores.length > 0) {
                        const sorteado = perdedores[Math.floor(Math.random() * perdedores.length)];
                        jogadores.push(sorteado);
                        alert(`${sorteado.nome} foi sorteado para completar a fase!`);
                    }
                }
            }
            
            // Embaralhar jogadores
            for (let i = jogadores.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [jogadores[i], jogadores[j]] = [jogadores[j], jogadores[i]];
            }
            
            // Criar confrontos
            const confrontos = [];
            for (let i = 0; i < jogadores.length; i += 2) {
                if (jogadores[i + 1]) {
                    confrontos.push({
                        id: `${modalidade}_${numeroFase}_${Date.now()}_${i}`,
                        jogador1: jogadores[i],
                        jogador2: jogadores[i + 1],
                        placar1: 0,
                        placar2: 0,
                        finalizado: false
                    });
                }
            }
            
            storage.fases[faseKey] = { numero: numeroFase, confrontos };
            if (!storage.jogos[modalidade]) storage.jogos[modalidade] = {};
            storage.jogos[modalidade][numeroFase] = confrontos;
            
            saveStorage();
            mostrarFaseAtual(modalidade);
            alert(`Fase ${numeroFase} criada com ${confrontos.length} confrontos!`);
        }

        function mostrarFaseAtual(modalidade) {
            const div = document.getElementById('faseAtual');
            const faseKey = `${modalidade}_fase`;
            
            if (!storage.fases[faseKey]) {
                div.innerHTML = '<p class="text-gray-500">Nenhuma fase criada ainda.</p>';
                return;
            }
            
            const fase = storage.fases[faseKey];
            let html = `<h3 class="font-bold mb-3">Fase ${fase.numero} - ${modalidade}</h3>`;
            
            fase.confrontos.forEach(c => {
                html += `
                    <div class="flex justify-between items-center p-3 border rounded mb-2 ${c.finalizado ? 'bg-green-50' : 'bg-yellow-50'}">
                        <span>${c.jogador1.nome} vs ${c.jogador2.nome}</span>
                        <span class="${c.finalizado ? 'text-green-600' : 'text-orange-600'}">
                            ${c.finalizado ? `${c.placar1} x ${c.placar2}` : 'Pendente'}
                        </span>
                    </div>
                `;
            });
            
            div.innerHTML = html;
        }

        // Event listener para select de modalidade nas fases
        document.getElementById('modalidadeSelect').onchange = (e) => {
            if (e.target.value) {
                mostrarFaseAtual(e.target.value);
            }
        };

        // Placares
        document.getElementById('modalidadePlacar').onchange = (e) => {
            mostrarJogosPendentes(e.target.value);
        };

        function mostrarJogosPendentes(modalidade) {
            const div = document.getElementById('jogosPendentes');
            div.innerHTML = '';
            
            if (!modalidade || !storage.jogos[modalidade]) {
                div.innerHTML = '<p class="text-gray-500">Nenhum jogo encontrado.</p>';
                return;
            }
            
            const fases = Object.keys(storage.jogos[modalidade]);
            const ultimaFase = Math.max(...fases.map(f => parseInt(f)));
            const jogos = storage.jogos[modalidade][ultimaFase] || [];
            
            const pendentes = jogos.filter(j => !j.finalizado);
            
            if (pendentes.length === 0) {
                div.innerHTML = '<p class="text-green-600">Todos os jogos da fase atual foram finalizados!</p>';
                return;
            }
            
            pendentes.forEach(jogo => {
                const jogoDiv = document.createElement('div');
                jogoDiv.className = 'p-4 border rounded bg-gray-50 mb-3';
                jogoDiv.innerHTML = `
                    <h4 class="font-semibold mb-3">${jogo.jogador1.nome} vs ${jogo.jogador2.nome}</h4>
                    <div class="grid grid-cols-2 gap-4 mb-3">
                        <div>
                            <label class="block text-sm font-medium">${jogo.jogador1.nome}</label>
                            <input type="number" min="0" max="2" value="${jogo.placar1}" 
                                   class="w-full p-2 border rounded" data-jogador="1" data-jogo="${jogo.id}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium">${jogo.jogador2.nome}</label>
                            <input type="number" min="0" max="2" value="${jogo.placar2}" 
                                   class="w-full p-2 border rounded" data-jogador="2" data-jogo="${jogo.id}">
                        </div>
                    </div>
                    <button onclick="salvarPlacar('${modalidade}', '${jogo.id}')" 
                            class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">
                        Salvar Placar
                    </button>
                `;
                div.appendChild(jogoDiv);
            });
        }

        function salvarPlacar(modalidade, jogoId) {
            const placar1Input = document.querySelector(`input[data-jogo="${jogoId}"][data-jogador="1"]`);
            const placar2Input = document.querySelector(`input[data-jogo="${jogoId}"][data-jogador="2"]`);
            
            const placar1 = parseInt(placar1Input.value);
            const placar2 = parseInt(placar2Input.value);
            
            if (placar1 < 0 || placar1 > 2 || placar2 < 0 || placar2 > 2) {
                alert('Placar deve ser entre 0 e 2!');
                return;
            }
            
            if (placar1 === placar2) {
                alert('Deve haver um vencedor! (2x0, 2x1, 1x2 ou 0x2)');
                return;
            }
            
            if (placar1 < 2 && placar2 < 2) {
                alert('Algu√©m deve fazer 2 pontos para vencer!');
                return;
            }
            
            // Atualizar jogo
            const fases = Object.keys(storage.jogos[modalidade]);
            const ultimaFase = Math.max(...fases.map(f => parseInt(f)));
            
            const jogoIndex = storage.jogos[modalidade][ultimaFase].findIndex(j => j.id === jogoId);
            if (jogoIndex !== -1) {
                storage.jogos[modalidade][ultimaFase][jogoIndex].placar1 = placar1;
                storage.jogos[modalidade][ultimaFase][jogoIndex].placar2 = placar2;
                storage.jogos[modalidade][ultimaFase][jogoIndex].finalizado = true;
                
                // Atualizar tamb√©m nas fases
                const faseKey = `${modalidade}_fase`;
                if (storage.fases[faseKey]) {
                    const confrontoIndex = storage.fases[faseKey].confrontos.findIndex(c => c.id === jogoId);
                    if (confrontoIndex !== -1) {
                        storage.fases[faseKey].confrontos[confrontoIndex].placar1 = placar1;
                        storage.fases[faseKey].confrontos[confrontoIndex].placar2 = placar2;
                        storage.fases[faseKey].confrontos[confrontoIndex].finalizado = true;
                    }
                }
                
                saveStorage();
                alert('Placar salvo!');
                mostrarJogosPendentes(modalidade);
                
                // Verificar se todos os jogos da fase terminaram
                const todosFinalizado = storage.jogos[modalidade][ultimaFase].every(j => j.finalizado);
                if (todosFinalizado) {
                    alert('Todos os jogos da fase finalizados! Voc√™ pode criar a pr√≥xima fase.');
                }
            }
        }

        function getVencedoresFase(modalidade, numeroFase) {
            if (!storage.jogos[modalidade] || !storage.jogos[modalidade][numeroFase]) return [];
            
            return storage.jogos[modalidade][numeroFase]
                .filter(j => j.finalizado)
                .map(j => j.placar1 > j.placar2 ? j.jogador1 : j.jogador2);
        }

        function getPerdedoresFase(modalidade, numeroFase) {
            if (!storage.jogos[modalidade] || !storage.jogos[modalidade][numeroFase]) return [];
            
            return storage.jogos[modalidade][numeroFase]
                .filter(j => j.finalizado)
                .map(j => j.placar1 < j.placar2 ? j.jogador1 : j.jogador2);
        }

        // Acompanhamento p√∫blico
        function carregarAcompanhamento() {
            const div = document.getElementById('jogosAcompanhar');
            div.innerHTML = '';
            
            if (Object.keys(storage.jogos).length === 0) {
                div.innerHTML = '<p class="text-gray-500">Nenhum campeonato iniciado ainda.</p>';
                return;
            }
            
            Object.keys(storage.jogos).forEach(modalidade => {
                const modalidadeDiv = document.createElement('div');
                modalidadeDiv.className = 'mb-6 p-4 border rounded-lg';
                
                let html = `<h3 class="text-lg font-bold mb-3">${modalidade}</h3>`;
                
                const fases = Object.keys(storage.jogos[modalidade]);
                fases.sort((a, b) => parseInt(b) - parseInt(a)); // Mais recente primeiro
                
                fases.forEach(numeroFase => {
                    const jogos = storage.jogos[modalidade][numeroFase];
                    html += `<h4 class="font-semibold mb-2">Fase ${numeroFase}</h4>`;
                    
                    jogos.forEach(jogo => {
                        if (jogo.finalizado) {
                            const vencedor = jogo.placar1 > jogo.placar2 ? jogo.jogador1.nome : jogo.jogador2.nome;
                            html += `
                                <div class="flex justify-between items-center p-2 mb-1 bg-green-50 border rounded">
                                    <span>${jogo.jogador1.nome} vs ${jogo.jogador2.nome}</span>
                                    <div class="text-right">
                                        <span class="font-mono">${jogo.placar1} x ${jogo.placar2}</span>
                                        <div class="text-xs text-green-600">Vencedor: ${vencedor}</div>
                                    </div>
                                </div>
                            `;
                        } else {
                            html += `
                                <div class="flex justify-between items-center p-2 mb-1 bg-yellow-50 border rounded">
                                    <span>${jogo.jogador1.nome} vs ${jogo.jogador2.nome}</span>
                                    <span class="text-orange-600 text-sm">Aguardando resultado</span>
                                </div>
                            `;
                        }
                    });
                });
                
                modalidadeDiv.innerHTML = html;
                div.appendChild(modalidadeDiv);
            });
        }

        // Reset campeonato
        document.getElementById('resetBtn').onclick = () => {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Isto apagar√° todas as fases, confrontos e placares!\n\nOs participantes inscritos ser√£o mantidos.\n\nDeseja continuar?')) {
                const senha = prompt('Digite a senha para confirmar:');
                if (senha === 'dpsp123') {
                    storage.fases = {};
                    storage.jogos = {};
                    saveStorage();
                    alert('‚úÖ Campeonato resetado com sucesso!');
                    
                    // Limpar interfaces
                    document.getElementById('faseAtual').innerHTML = '';
                    document.getElementById('jogosPendentes').innerHTML = '';
                    document.getElementById('jogosAcompanhar').innerHTML = '';
                } else if (senha) {
                    alert('Senha incorreta!');
                }
            }
        };

        // Inicializa√ß√£o
        window.onload = () => {
            carregarModalidades();
            showSection('inscricao');
        };
