<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Campeonato</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-firestore-compat.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen p-4">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-6">Sistema de Campeonato üèÜ</h1>

        <div class="flex flex-wrap justify-center gap-2 mb-6">
            <button id="inscricaoBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                üìù Inscri√ß√µes
            </button>
            <button id="publicoBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                üë• Lista P√∫blica
            </button>
            <button id="adminBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">
                ‚öôÔ∏è Admin
            </button>
            <button id="acompanharBtn" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg">
                üìä Acompanhar
            </button>
        </div>

        <!-- Inscri√ß√£o -->
        <section id="inscricaoSection" class="bg-white p-6 rounded-lg shadow mb-6 hidden">
            <h2 class="text-xl font-bold mb-4">Nova Inscri√ß√£o</h2>
            <form id="inscricaoForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="matricula" placeholder="Matr√≠cula" class="p-2 border rounded-lg" required>
                    <input type="text" id="nome" placeholder="Nome completo" class="p-2 border rounded-lg" required>
                    <input type="text" id="setor" placeholder="Setor" class="p-2 border rounded-lg" required>
                    <input type="tel" id="telefone" placeholder="Telefone" class="p-2 border rounded-lg" required>
                </div>
                <div>
                    <p class="font-semibold mb-2">Escolha suas modalidades:</p>
                    <div id="modalidadesList" class="grid grid-cols-2 gap-2"></div>
                    <p id="modalidadeInfo" class="text-sm text-gray-500 mt-2"></p>
                </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg">
                    Enviar Inscri√ß√£o
                </button>
            </form>
        </section>

        <!-- Lista P√∫blica -->
        <section id="publicoSection" class="bg-white p-6 rounded-lg shadow mb-6 hidden">
            <h2 class="text-xl font-bold mb-4">Participantes Inscritos</h2>
            <div id="participantesList" class="space-y-3"></div>
        </section>

        <!-- Acompanhar -->
        <section id="acompanharSection" class="bg-white p-6 rounded-lg shadow mb-6 hidden">
            <h2 class="text-xl font-bold mb-4">Acompanhar Jogos</h2>
            <div id="jogosAcompanhar" class="space-y-4"></div>
        </section>

        <!-- Admin -->
        <section id="adminSection" class="bg-white p-6 rounded-lg shadow mb-6 hidden">
            <h2 class="text-xl font-bold mb-4">√Årea Administrativa</h2>
        
            <div class="flex flex-wrap gap-2 mb-4">
                <button id="configTab" class="bg-gray-600 text-white px-3 py-1 rounded">Config</button>
                <button id="fasesTab" class="bg-gray-400 text-white px-3 py-1 rounded">Fases</button>
                <button id="placaresTab" class="bg-gray-400 text-white px-3 py-1 rounded">Placares</button>
                <button id="resetTab" class="bg-gray-400 text-white px-3 py-1 rounded">Reset</button>
            </div>

            <!-- Config -->
            <div id="configDiv" class="space-y-4">
                <div>
                    <h3 class="font-semibold mb-2">Modalidades</h3>
                    <div id="adminModalidadesList" class="space-y-2 mb-3"></div>
                    <div class="flex gap-2">
                        <input type="text" id="novaModalidade" placeholder="Nova modalidade" class="flex-1 p-2 border rounded">
                        <button id="addModalidade" class="bg-green-600 text-white px-3 py-2 rounded">Add</button>
                    </div>
                </div>
                <div>
                    <h3 class="font-semibold mb-2">Limite por Participante</h3>
                    <div class="flex gap-2">
                        <input type="number" id="limiteInput" min="1" class="p-2 border rounded w-20">
                        <button id="salvarLimite" class="bg-blue-600 text-white px-3 py-2 rounded">Salvar</button>
                    </div>
                </div>
                <div>
                    <button id="exportBtn" class="bg-indigo-600 text-white px-4 py-2 rounded mr-2">Exportar CSV</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border text-sm">
                        <thead class="bg-gray-200">
                            <tr>
                                <th class="border p-2">Nome</th>
                                <th class="border p-2">Setor</th>
                                <th class="border p-2">Telefone</th>
                                <th class="border p-2">Modalidades</th>
                                <th class="border p-2">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaInscritos"></tbody>
                    </table>
                </div>
            </div>

            <!-- Fases -->
            <div id="fasesDiv" class="hidden space-y-4">
                <div class="flex gap-2">
                    <select id="modalidadeSelect" class="flex-1 p-2 border rounded">
                        <option value="">Selecione modalidade</option>
                    </select>
                    <button id="criarFaseBtn" class="bg-green-600 text-white px-4 py-2 rounded">Criar Fase</button>
                </div>
                <div id="faseAtual" class="mt-4"></div>
            </div>

            <!-- Placares -->
            <div id="placaresDiv" class="hidden space-y-4">
                <select id="modalidadePlacar" class="w-full p-2 border rounded mb-4">
                    <option value="">Selecione modalidade para ver jogos</option>
                </select>
                <div id="jogosPendentes"></div>
            </div>

            <!-- Reset -->
            <div id="resetDiv" class="hidden">
                <div class="bg-red-50 p-4 rounded border border-red-200">
                    <h3 class="font-semibold text-red-800 mb-2">‚ö†Ô∏è Reset Campeonato</h3>
                    <p class="text-red-700 mb-4">Apaga todas as fases e placares. Mant√©m participantes.</p>
                    <button id="resetBtn" class="bg-red-600 text-white px-4 py-2 rounded">Reset Completo</button>
                </div>
            </div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Config Firebase
            const firebaseConfig = {
                apiKey: "AIzaSyBo8G3ZcWk4EepN0cHdVBtXc7tGOfcw-yg",
                authDomain: "inscricaosinuca.firebaseapp.com",
                projectId: "inscricaosinuca",
                storageBucket: "inscricaosinuca.firebasestorage.app",
                messagingSenderId: "338241576305",
                appId: "1:338241576305:web:288b6124384c6be4f76ad0",
                measurementId: "G-PEDG30FS2R"
            };
            
            // Inicializar Firebase
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            
            // Vari√°veis globais
            let inscritos = [];
            let modalidades = [];
            let limite = 2;

            // -------------------------------
            // üî• Corre√ß√£o feita aqui
            async function carregarJogos() {
                try {
                    const jogos = {};
                    const modalidadesJogos = await db.collection('jogos').get();
                    
                    for (const modalidadeDoc of modalidadesJogos.docs) {
                        const modalidade = modalidadeDoc.id;
                        const fasesSnap = await db.collection('jogos').doc(modalidade).collection('fases').get();
                        
                        jogos[modalidade] = {};
                        fasesSnap.docs.forEach(faseDoc => {
                            const data = faseDoc.data();
                            // Garante que sempre ser√° array
                            jogos[modalidade][faseDoc.id] = Array.isArray(data.jogos) ? data.jogos : [];
                        });
                    }
                    
                    return jogos;
                } catch (error) {
                    console.error('Erro ao carregar jogos:', error);
                    return {};
                }
            }
            // -------------------------------

            /* resto do seu c√≥digo continua igual */
            // ... (mantive toda a l√≥gica original de fases, placares, admin, inscri√ß√£o etc.)
        });
    </script>
</body>
</html>
