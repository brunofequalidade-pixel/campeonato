<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Campeonato</title>
<script src="https://cdn.tailwindcss.com"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

// Config Firebase com sua chave
const firebaseConfig = {
    apiKey: "AIzaSyBo8G3ZcWk4EepN0cHdVBtXc7tGOfcw-yg",
    authDomain: "inscricaosinuca.firebaseapp.com",
    projectId: "inscricaosinuca",
    storageBucket: "inscricaosinuca.firebasestorage.app",
    messagingSenderId: "338241576305",
    appId: "1:338241576305:web:288b6124384c6be4f76ad0",
    measurementId: "G-PEDG30FS2R"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Fun√ß√µes globais para inscri√ß√µes e modalidades
window.salvarInscricaoFirebase = async (inscricao) => {
    await addDoc(collection(db, "inscritos"), inscricao);
};

window.carregarInscritosFirebase = async () => {
    const snapshot = await getDocs(collection(db, "inscritos"));
    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
};

window.carregarModalidadesFirebase = async () => {
    const docRef = doc(db, "config", "modalidades");
    const docSnap = await getDoc(docRef);
    if (!docSnap.exists()) {
        await setDoc(docRef, { lista: ["Sinuca", "Domin√≥", "Dama"], limite: 2 });
        return { lista: ["Sinuca", "Domin√≥", "Dama"], limite: 2 };
    }
    return docSnap.data();
};

window.salvarModalidadesFirebase = async (modalidades) => {
    await setDoc(doc(db, "config", "modalidades"), modalidades);
};
</script>
</head>
<body class="bg-gray-100 min-h-screen p-4">
<div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold text-center mb-6">Sistema de Campeonato üèÜ</h1>

    <div class="flex flex-wrap justify-center gap-2 mb-6">
        <button id="inscricaoBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">üìù Inscri√ß√µes</button>
        <button id="publicoBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">üë• Lista P√∫blica</button>
        <button id="adminBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">‚öôÔ∏è Admin</button>
    </div>

    <!-- Se√ß√µes -->
    <section id="inscricaoSection" class="bg-white p-6 rounded-lg shadow mb-6">
        <h2 class="text-xl font-bold mb-4">Nova Inscri√ß√£o</h2>
        <form id="inscricaoForm" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="text" id="matricula" placeholder="Matr√≠cula" class="p-2 border rounded-lg" required>
                <input type="text" id="nome" placeholder="Nome completo" class="p-2 border rounded-lg" required>
                <input type="text" id="setor" placeholder="Setor" class="p-2 border rounded-lg" required>
                <input type="tel" id="telefone" placeholder="Telefone" class="p-2 border rounded-lg" required>
            </div>
            <div>
                <p class="font-semibold mb-2">Escolha suas modalidades:</p>
                <div id="modalidadesList" class="grid grid-cols-2 gap-2"></div>
                <p id="modalidadeInfo" class="text-sm text-gray-500 mt-2"></p>
            </div>
            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg">Enviar Inscri√ß√£o</button>
        </form>
    </section>

    <section id="publicoSection" class="bg-white p-6 rounded-lg shadow mb-6 hidden">
        <h2 class="text-xl font-bold mb-4">Participantes Inscritos</h2>
        <div id="participantesList" class="space-y-3"></div>
    </section>

    <section id="adminSection" class="bg-white p-6 rounded-lg shadow mb-6 hidden">
        <h2 class="text-xl font-bold mb-4">√Årea Administrativa</h2>
        <div class="flex flex-wrap gap-2 mb-4">
            <button id="configTab" class="bg-gray-600 text-white px-3 py-1 rounded">Config</button>
        </div>

        <div id="configDiv" class="space-y-4">
            <div>
                <h3 class="font-semibold mb-2">Modalidades</h3>
                <div id="adminModalidadesList" class="space-y-2 mb-3"></div>
                <div class="flex gap-2">
                    <input type="text" id="novaModalidade" placeholder="Nova modalidade" class="flex-1 p-2 border rounded">
                    <button id="addModalidade" class="bg-green-600 text-white px-3 py-2 rounded">Add</button>
                </div>
            </div>
            <div>
                <h3 class="font-semibold mb-2">Limite por Participante</h3>
                <div class="flex gap-2">
                    <input type="number" id="limiteInput" min="1" value="2" class="p-2 border rounded w-20">
                    <button id="salvarLimite" class="bg-blue-600 text-white px-3 py-2 rounded">Salvar</button>
                </div>
            </div>
        </div>
    </section>
</div>

<script type="module">
let limite = 2;
let modalidades = [];

async function carregarModalidades() {
    const dados = await carregarModalidadesFirebase();
    modalidades = dados.lista;
    limite = dados.limite || 2;

    const lista = document.getElementById('modalidadesList');
    lista.innerHTML = '';
    modalidades.forEach(m => {
        const label = document.createElement('label');
        label.className = 'flex items-center gap-2 p-2 border rounded cursor-pointer';
        label.innerHTML = `<input type="checkbox" value="${m}"> ${m}`;
        lista.appendChild(label);
    });

    const adminLista = document.getElementById('adminModalidadesList');
    adminLista.innerHTML = '';
    modalidades.forEach(m => {
        const div = document.createElement('div');
        div.className = 'flex justify-between items-center p-2 border rounded';
        div.innerHTML = `<span>${m}</span><button onclick="removerModalidade('${m}')" class="text-red-600 px-2">üóëÔ∏è</button>`;
        adminLista.appendChild(div);
    });

    document.getElementById('modalidadeInfo').textContent = `Escolha at√© ${limite} modalidade(s)`;
    document.getElementById('limiteInput').value = limite;
}

async function removerModalidade(modalidade) {
    if (confirm(`Remover ${modalidade}?`)) {
        const novaLista = modalidades.filter(m => m !== modalidade);
        await salvarModalidadesFirebase({ lista: novaLista, limite });
        carregarModalidades();
    }
}

document.getElementById('addModalidade').onclick = async () => {
    const nome = document.getElementById('novaModalidade').value.trim();
    if (nome && !modalidades.includes(nome)) {
        modalidades.push(nome);
        await salvarModalidadesFirebase({ lista: modalidades, limite });
        document.getElementById('novaModalidade').value = '';
        carregarModalidades();
        alert('Modalidade adicionada!');
    } else alert('Nome inv√°lido ou j√° existe!');
};

document.getElementById('salvarLimite').onclick = async () => {
    const novoLimite = parseInt(document.getElementById('limiteInput').value);
    if (novoLimite > 0) {
        limite = novoLimite;
        await salvarModalidadesFirebase({ lista: modalidades, limite });
        carregarModalidades();
        alert('Limite salvo!');
    }
};

document.getElementById('inscricaoForm').onsubmit = async (e) => {
    e.preventDefault();
    const matricula = document.getElementById('matricula').value.trim();
    const nome = document.getElementById('nome').value.trim();
    const setor = document.getElementById('setor').value.trim();
    const telefone = document.getElementById('telefone').value.trim();
    const escolhidas = Array.from(document.querySelectorAll('#modalidadesList input:checked')).map(c => c.value);

    if (!matricula || !nome || !setor || !telefone) { alert('Preencha todos os campos!'); return; }
    if (escolhidas.length === 0 || escolhidas.length > limite) { alert(`Escolha entre 1 e ${limite} modalidades!`); return; }

    const inscritos = await carregarInscritosFirebase();
    if (inscritos.find(i => i.matricula === matricula)) { alert('Matr√≠cula j√° inscrita!'); return; }

    await salvarInscricaoFirebase({ matricula, nome, setor, telefone, modalidades: escolhidas, criado: new Date().toISOString() });
    alert('Inscri√ß√£o realizada!');
    document.getElementById('inscricaoForm').reset();
    carregarModalidades();
};

async function carregarListaPublica() {
    const lista = document.getElementById('participantesList');
    lista.innerHTML = '';
    const inscritos = await carregarInscritosFirebase();
    if (inscritos.length === 0) { lista.innerHTML = '<p class="text-gray-500">Nenhum participante ainda.</p>'; return; }
    inscritos.forEach(p => {
        const div = document.createElement('div');
        div.className = 'p-3 border rounded-lg';
        div.innerHTML = `<h3 class="font-semibold">${p.nome}</h3><p class="text-gray-600">${p.setor}</p><p class="text-sm text-blue-600">Modalidades: ${p.modalidades.join(', ')}</p>`;
        lista.appendChild(div);
    });
}

// Navega√ß√£o
function showSection(section) {
    document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
    document.getElementById(section + 'Section').classList.remove('hidden');
}
document.getElementById('inscricaoBtn').onclick = () => showSection('inscricao');
document.getElementById('publicoBtn').onclick = () => { showSection('publico'); carregarListaPublica(); };

window.onload = async () => { await carregarModalidades(); showSection('inscricao'); };
</script>
</body>
</html>
