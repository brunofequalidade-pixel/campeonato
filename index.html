<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sistema de Campeonato (Firestore)</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-4">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold text-center mb-6">Sistema de Campeonato 🏆 (Firestore)</h1>

    <!-- MENU -->
    <div class="flex flex-wrap justify-center gap-2 mb-6">
      <button id="inscricaoBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">📝 Inscrições</button>
      <button id="publicoBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">👥 Lista Pública</button>
      <button id="adminBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">⚙️ Admin</button>
    </div>

    <!-- INSCRIÇÃO -->
    <section id="inscricaoSection" class="bg-white p-6 rounded-lg shadow mb-6">
      <h2 class="text-xl font-bold mb-4">Nova Inscrição</h2>
      <form id="inscricaoForm" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <input type="text" id="matricula" placeholder="Matrícula" class="p-2 border rounded-lg" required>
          <input type="text" id="nome" placeholder="Nome completo" class="p-2 border rounded-lg" required>
          <input type="text" id="setor" placeholder="Setor" class="p-2 border rounded-lg" required>
          <input type="tel" id="telefone" placeholder="Telefone" class="p-2 border rounded-lg" required>
        </div>
        <div>
          <p class="font-semibold mb-2">Escolha suas modalidades:</p>
          <div id="modalidadesList" class="grid grid-cols-2 gap-2"></div>
        </div>
        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg">Enviar Inscrição</button>
      </form>
    </section>

    <!-- LISTA PÚBLICA -->
    <section id="publicoSection" class="bg-white p-6 rounded-lg shadow mb-6 hidden">
      <h2 class="text-xl font-bold mb-4">Participantes Inscritos</h2>
      <div id="participantesList" class="space-y-3"></div>
    </section>

    <!-- ADMIN -->
    <section id="adminSection" class="bg-white p-6 rounded-lg shadow mb-6 hidden">
      <h2 class="text-xl font-bold mb-4">Área Administrativa</h2>
      <div class="flex flex-wrap gap-2 mb-4">
        <button id="configTab" class="bg-gray-600 text-white px-3 py-1 rounded">Config</button>
        <button id="resetTab" class="bg-gray-400 text-white px-3 py-1 rounded">Reset</button>
      </div>

      <!-- CONFIG -->
      <div id="configDiv" class="space-y-4">
        <div>
          <h3 class="font-semibold mb-2">Modalidades</h3>
          <div id="adminModalidadesList" class="space-y-2 mb-3"></div>
          <div class="flex gap-2">
            <input type="text" id="novaModalidade" placeholder="Nova modalidade" class="flex-1 p-2 border rounded">
            <button id="addModalidade" class="bg-green-600 text-white px-3 py-2 rounded">Add</button>
          </div>
        </div>
        <div>
          <h3 class="font-semibold mb-2">Limite por Participante</h3>
          <div class="flex gap-2">
            <input type="number" id="limiteInput" min="1" value="2" class="p-2 border rounded w-20">
            <button id="salvarLimite" class="bg-blue-600 text-white px-3 py-2 rounded">Salvar</button>
          </div>
        </div>
        <div>
          <button id="exportBtn" class="bg-indigo-600 text-white px-4 py-2 rounded mr-2">Exportar CSV</button>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full border text-sm">
            <thead class="bg-gray-200">
              <tr>
                <th class="border p-2">Nome</th>
                <th class="border p-2">Setor</th>
                <th class="border p-2">Modalidades</th>
                <th class="border p-2">Ações</th>
              </tr>
            </thead>
            <tbody id="tabelaInscritos"></tbody>
          </table>
        </div>
      </div>

      <!-- RESET -->
      <div id="resetDiv" class="hidden">
        <div class="bg-red-50 p-4 rounded border border-red-200">
          <h3 class="font-semibold text-red-800 mb-2">⚠️ Reset Campeonato</h3>
          <p class="text-red-700 mb-4">Apaga todos os inscritos e modalidades.</p>
          <button id="resetBtn" class="bg-red-600 text-white px-4 py-2 rounded">Reset Completo</button>
        </div>
      </div>
    </section>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
  import {
    getFirestore, collection, doc, addDoc, getDocs, deleteDoc, setDoc
  } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

  // Config Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBo8G3ZcWk4EepN0cHdVBtXc7tGOfcw-yg",
    authDomain: "inscricaosinuca.firebaseapp.com",
    projectId: "inscricaosinuca",
    storageBucket: "inscricaosinuca.firebasestorage.app",
    messagingSenderId: "338241576305",
    appId: "1:338241576305:web:288b6124384c6be4f76ad0",
    measurementId: "G-PEDG30FS2R"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const inscritosCol = collection(db, "inscritos");
  const modalidadesCol = collection(db, "modalidades");
  const configDoc = doc(db, "config", "geral");

  // === Navegação ===
  function showSection(section) {
    document.querySelectorAll("section").forEach(s => s.classList.add("hidden"));
    document.getElementById(section + "Section").classList.remove("hidden");
  }

  document.getElementById("inscricaoBtn").addEventListener("click", () => showSection("inscricao"));
  document.getElementById("publicoBtn").addEventListener("click", carregarListaPublica);
  document.getElementById("adminBtn").addEventListener("click", () => {
    const senha = prompt("Senha do administrador:");
    if (senha === "dpsp123") { showSection("admin"); }
    else { alert("Senha incorreta!"); }
  });

  // === Tabs Admin ===
  function showAdminTab(tab) {
    ["config","reset"].forEach(name => {
      document.getElementById(name+"Div").classList.add("hidden");
      document.getElementById(name+"Tab").classList.replace("bg-gray-600","bg-gray-400");
    });
    document.getElementById(tab+"Div").classList.remove("hidden");
    document.getElementById(tab+"Tab").classList.replace("bg-gray-400","bg-gray-600");
  }
  document.getElementById("configTab").addEventListener("click",()=>showAdminTab("config"));
  document.getElementById("resetTab").addEventListener("click",()=>showAdminTab("reset"));

  // === Inscrição ===
  document.getElementById("inscricaoForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const matricula = document.getElementById("matricula").value;
    const nome = document.getElementById("nome").value;
    const setor = document.getElementById("setor").value;
    const telefone = document.getElementById("telefone").value;
    const modalidades = Array.from(document.querySelectorAll("#modalidadesList input:checked")).map(c=>c.value);
    await addDoc(inscritosCol, { matricula, nome, setor, telefone, modalidades });
    alert("Inscrição salva!");
    e.target.reset();
  });

  // === Lista Pública ===
  async function carregarListaPublica() {
    showSection("publico");
    const snap = await getDocs(inscritosCol);
    const div = document.getElementById("participantesList");
    div.innerHTML = "";
    snap.forEach(d=>{
      const p = d.data();
      div.innerHTML += `<div class="p-3 border rounded-lg"><h3 class="font-semibold">${p.nome}</h3><p>${p.setor}</p></div>`;
    });
  }

  // === Modalidades ===
  async function carregarModalidades() {
    const snap = await getDocs(modalidadesCol);
    const lista = document.getElementById("modalidadesList");
    const admin = document.getElementById("adminModalidadesList");
    lista.innerHTML = ""; admin.innerHTML = "";
    snap.forEach(d=>{
      const m = d.data().nome;
      lista.innerHTML += `<label class="flex items-center gap-2"><input type="checkbox" value="${m}"> ${m}</label>`;
      admin.innerHTML += `<div class="flex justify-between p-2 border rounded"><span>${m}</span><button onclick="removerModalidade('${d.id}')" class="text-red-600">🗑️</button></div>`;
    });
  }
  carregarModalidades();

  document.getElementById("addModalidade").addEventListener("click", async ()=>{
    const nome = document.getElementById("novaModalidade").value;
    if(!nome) return;
    await addDoc(modalidadesCol,{nome});
    document.getElementById("novaModalidade").value="";
    carregarModalidades();
  });

  window.removerModalidade = async (id)=>{
    await deleteDoc(doc(db,"modalidades",id));
    carregarModalidades();
  };

  // === Limite ===
  document.getElementById("salvarLimite").addEventListener("click", async ()=>{
    const limite = parseInt(document.getElementById("limiteInput").value)||2;
    await setDoc(configDoc,{limite});
    alert("Limite salvo!");
  });

  // === Exportar CSV ===
  document.getElementById("exportBtn").addEventListener("click", async ()=>{
    const snap = await getDocs(inscritosCol);
    let csv = "Nome,Setor,Telefone,Modalidades\n";
    snap.forEach(d=>{
      const p=d.data();
      csv+=`${p.nome},${p.setor},${p.telefone},"${(p.modalidades||[]).join("|")}"\n`;
    });
    const blob = new Blob([csv],{type:"text/csv"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="inscritos.csv";
    a.click();
  });

  // === Reset ===
  document.getElementById("resetBtn").addEventListener("click", async ()=>{
    if(!confirm("Apagar tudo?")) return;
    const ins=await getDocs(inscritosCol); ins.forEach(d=>deleteDoc(d.ref));
    const mod=await getDocs(modalidadesCol); mod.forEach(d=>deleteDoc(d.ref));
    alert("Reset feito!");
    carregarModalidades();
    carregarListaPublica();
  });

  // Inicialização
  window.onload = ()=>{ showSection("inscricao"); showAdminTab("config"); };
</script>
</body>
</html>
