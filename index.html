const faseParaExcluirSelect = document.getElementById("faseParaExcluir");
const apagarFaseBtn = document.getElementById("apagarFaseBtn");

// Função para atualizar select de fases com base nos placares
async function carregarFasesExistentes() {
  faseParaExcluirSelect.innerHTML = `<option value="">-- Selecionar fase --</option>`;
  try {
    const snap = await getDocs(collection(db, "placar"));
    const fasesSet = new Set();
    snap.forEach(d => {
      if (d.data().fase) fasesSet.add(d.data().fase);
    });
    const fases = Array.from(fasesSet).sort((a,b)=>a-b);
    fases.forEach(f => {
      const opt = document.createElement("option");
      opt.value = f;
      opt.textContent = `Fase ${f}`;
      faseParaExcluirSelect.appendChild(opt);
    });
  } catch (err) {
    console.error("Erro carregar fases existentes:", err);
  }
}

// Apagar fase selecionada
apagarFaseBtn.addEventListener("click", async () => {
  const faseSelecionada = parseInt(faseParaExcluirSelect.value);
  if (!faseSelecionada) return alert("Selecione uma fase para apagar!");
  if (!confirm(`Deseja apagar a Fase ${faseSelecionada}?`)) return;
  await apagarPlacaresFase(faseSelecionada);
  await carregarFasesExistentes();
});

// Atualiza fases sempre que carregamos placares
onSnapshot(collection(db, "placar"), () => {
  carregarFasesExistentes();
});
