<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Sistema de Campeonato (Firestore) - Duplas Manuais</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-4">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-6">Sistema de Campeonato 🏆</h1>

        <div class="flex flex-wrap justify-center gap-2 mb-6">
            <button id="inscricaoBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">📝 Inscrições</button>
            <button id="publicoBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">👥 Lista Pública</button>
            <button id="acompanharBtn" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg">📊 Acompanhar</button>
            <button id="adminBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg">⚙️ Admin</button>
        </div>

        <!-- Painel Admin -->
        <section id="adminSection" class="bg-white p-6 rounded-lg shadow mb-6 hidden">
            <h2 class="text-xl font-bold mb-4">Área Administrativa</h2>
            
            <div class="mb-6">
                <h3 class="font-semibold mb-2">Escolher Modalidade</h3>
                <select id="faseModalidade" class="p-2 border rounded mb-4 w-full md:w-auto"></select>
                <button id="carregarJogadoresBtn" class="bg-blue-600 text-white px-4 py-2 rounded">Carregar Jogadores</button>
            </div>

            <div id="jogadoresDisponiveis" class="mb-6">
                <h3 class="font-semibold mb-2">Jogadores Disponíveis</h3>
                <div id="listaJogadores" class="flex flex-wrap gap-2"></div>
            </div>

            <div id="duplasCriadasDiv" class="mb-6">
                <h3 class="font-semibold mb-2">Duplas Criadas</h3>
                <div id="listaDuplas" class="space-y-2"></div>
                <button id="gerarConfrontosBtn" class="mt-4 bg-green-600 text-white px-4 py-2 rounded">Gerar Confrontos</button>
            </div>
        </section>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getFirestore, collection, doc, addDoc, getDocs, setDoc, query, where } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBo8G3ZcWk4EepN0cHdVBtXc7tGOfcw-yg",
            authDomain: "inscricaosinuca.firebaseapp.com",
            projectId: "inscricaosinuca",
            storageBucket: "inscricaosinuca.firebasestorage.app",
            messagingSenderId: "338241576305",
            appId: "1:338241576305:web:288b6124384c6be4f76ad0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const inscritosCol = collection(db, "inscritos");
        const duplasCol = collection(db, "duplas");
        const jogosCol = collection(db, "jogos");

        // --- Navegação ---
        function showSection(name) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.getElementById(name + 'Section').classList.remove('hidden');
        }

        document.getElementById('adminBtn').addEventListener('click', async () => {
            const senha = prompt("Senha do administrador:");
            if (senha === 'caio') {
                showSection('admin');
                carregarModalidades();
            } else if (senha) {
                alert('Senha incorreta');
            }
        });

        // --- Modalidades ---
        async function carregarModalidades() {
            const snap = await getDocs(collection(db, "modalidades"));
            const arr = snap.docs.map(d => d.data());
            const select = document.getElementById('faseModalidade');
            select.innerHTML = '<option value="">Selecione</option>';
            arr.forEach(m => {
                select.insertAdjacentHTML('beforeend', `<option value="${m.nome}">${m.nome}</option>`);
            });
        }

        // --- Carregar jogadores ---
        document.getElementById('carregarJogadoresBtn').addEventListener('click', async () => {
            const modalidade = document.getElementById('faseModalidade').value;
            if (!modalidade) return alert("Selecione uma modalidade");

            const snap = await getDocs(query(inscritosCol, where("modalidades", "array-contains", modalidade)));
            const lista = document.getElementById('listaJogadores');
            lista.innerHTML = '';
            snap.docs.forEach(d => {
                const p = d.data();
                const div = document.createElement('div');
                div.className = 'p-2 border rounded cursor-pointer bg-white hover:bg-gray-200';
                div.textContent = p.nome;
                div.onclick = () => selecionarJogador(p.nome, modalidade);
                lista.appendChild(div);
            });
        });

        let jogadoresSelecionados = [];
        let duplas = [];

        function selecionarJogador(nome, modalidade) {
            jogadoresSelecionados.push(nome);
            if (jogadoresSelecionados.length === 2) {
                const dupla = { modalidade, fase: 1, nomes: [...jogadoresSelecionados] };
                duplas.push(dupla);
                jogadoresSelecionados = [];
                atualizarListaDuplas();
            }
        }

        function atualizarListaDuplas() {
            const lista = document.getElementById('listaDuplas');
            lista.innerHTML = '';
            duplas.forEach((d, i) => {
                lista.insertAdjacentHTML('beforeend', `<div class="p-2 border rounded bg-gray-50">Dupla ${i+1}: ${d.nomes.join(' + ')}</div>`);
            });
        }

        // --- Gerar confrontos ---
        document.getElementById('gerarConfrontosBtn').addEventListener('click', async () => {
            if (duplas.length < 2) return alert("Crie pelo menos 2 duplas");

            for (let i = 0; i < duplas.length; i += 2) {
                if (i+1 >= duplas.length) break;
                const d1 = duplas[i];
                const d2 = duplas[i+1];

                await addDoc(jogosCol, {
                    modalidade: d1.modalidade,
                    fase: 1,
                    dupla1: d1.nomes.join(' + '),
                    dupla2: d2.nomes.join(' + '),
                    placar1: 0,
                    placar2: 0,
                    finalizado: false
                });
            }
            alert("Confrontos criados com sucesso!");
            duplas = [];
            atualizarListaDuplas();
        });
    </script>
</body>
</html>
